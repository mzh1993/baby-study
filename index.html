
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <base href="./">
    <link rel="manifest" href="manifest.json">
    <title>å®è´è¶£å­¦å ‚ ğŸˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            font-family: 'ZCOOL KuaiLe', cursive; 
            -webkit-tap-highlight-color: transparent; 
            overflow: hidden; 
            background-color: #FFFBEB;
            touch-action: manipulation;
            user-select: none;
        }
        .bouncy { animation: bounce 0.8s infinite alternate ease-in-out; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        
        .pop-up { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.6); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .jelly-btn:active { transform: scale(0.92); transition: 0.1s; }
        
        .confetti-piece { position: absolute; width: 12px; height: 12px; top: -20px; opacity: 0; animation: fall 3s ease-out forwards; z-index: 100; }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        ::-webkit-scrollbar { display: none; }
        .safe-area-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 5rem); }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 4px solid white;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        }

        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- æ•°æ®é…ç½® (å…¨é‡æ•´åˆ) ---
        const WORDS = ["å°é¸¡", "è§é¢", "å°è±¡", "å°ç¾Š", "å°ç‹—", "æ‰‹", "æ‹‰æ‹‰æ‰‹", "æ‹›æ‹›æ‰‹", "çš®çƒ", "é£", "å¤§æ ‘", "å°", "å¤§", "ç«æŠŠ", "å°¾å·´", "æ°´", "é’è›™", "å°æ²³", "é¸­å­", "æ²³é©¬", "ä¹Œé¾Ÿ", "é—¨", "æ°´é¾™å¤´", "å¹¼å„¿å›­", "æ³¡æ³¡", "å–·", "é¦™çš‚", "å¹²å‡€", "æ¯›å·¾", "æ´—", "è½¦ç«™", "æ±½è½¦", "å°çŒª", "å…”å­", "éƒŠæ¸¸", "æœˆç‰™", "å“", "é—¨é“ƒ", "å…¬å›­", "ä¸‹æ£‹", "å¤ªé˜³", "ç”»ç”»", "å¦ˆå¦ˆ", "çˆ¸çˆ¸", "å°çŒ«", "æœ‹å‹", "åœŸ", "ä»“é¼ ", "æ´", "èŠ±", "ä½", "é«˜", "å¥¶å¥¶", "é•¿å¤§", "å“¥å“¥", "çˆ·çˆ·", "å¦¹å¦¹", "çˆ±å¿ƒ", "è¡£æœ", "å¤´å‘"];
        
        const EMOJIS = {"å°é¸¡":"ğŸ¥","è§é¢":"ğŸ¤","å°è±¡":"ğŸ˜","å°ç¾Š":"ğŸ‘","å°ç‹—":"ğŸ¶","æ‰‹":"âœ‹","æ‹‰æ‹‰æ‰‹":"ğŸ¤","æ‹›æ‹›æ‰‹":"ğŸ™‹","çš®çƒ":"ğŸ€","é£":"ğŸ’¨","å¤§æ ‘":"ğŸŒ³","å°":"ğŸœ","å¤§":"ğŸ˜","ç«æŠŠ":"ğŸ”¥","å°¾å·´":"ğŸ’","æ°´":"ğŸ’§","é’è›™":"ğŸ¸","å°æ²³":"ğŸŒŠ","é¸­å­":"ğŸ¦†","æ²³é©¬":"ğŸ¦›","ä¹Œé¾Ÿ":"ğŸ¢","é—¨":"ğŸšª","æ°´é¾™å¤´":"ğŸš°","å¹¼å„¿å›­":"ğŸ«","æ³¡æ³¡":"ğŸ«§","å–·":"ğŸš¿","é¦™çš‚":"ğŸ§¼","å¹²å‡€":"âœ¨","æ¯›å·¾":"ğŸ§£","æ´—":"ğŸ›","è½¦ç«™":"ğŸš‰","æ±½è½¦":"ğŸš—","å°çŒª":"ğŸ·","å…”å­":"ğŸ°","éƒŠæ¸¸":"ğŸ•ï¸","æœˆç‰™":"ğŸŒ™","å“":"ğŸ””","é—¨é“ƒ":"ğŸ›ï¸","å…¬å›­":"ğŸ ","ä¸‹æ£‹":"â™Ÿï¸","å¤ªé˜³":"â˜€ï¸","ç”»ç”»":"ğŸ¨","å¦ˆå¦ˆ":"ğŸ‘©","çˆ¸çˆ¸":"ğŸ‘¨","å°çŒ«":"ğŸ±","æœ‹å‹":"ğŸ‘«","åœŸ":"ğŸª´","ä»“é¼ ":"ğŸ¹","æ´":"ğŸ•³ï¸","èŠ±":"ğŸŒ¸","ä½":"ğŸ‘‡","é«˜":"ğŸ‘†","å¥¶å¥¶":"ğŸ‘µ","é•¿å¤§":"ğŸŒ±","å“¥å“¥":"ğŸ‘¦","çˆ·çˆ·":"ğŸ‘´","å¦¹å¦¹":"ğŸ‘§","çˆ±å¿ƒ":"â¤ï¸","è¡£æœ":"ğŸ‘•","å¤´å‘":"ğŸ’‡"};
        
        const SONGS = [
            { id: 's1', title: 'å¨ƒå¨ƒçš„æ‰‹', content: ['ç¦»å¾—è¿œï¼Œæ‹›æ‹›æ‰‹ï¼Œ', 'èµ°è¿‘å•¦ï¼Œæ¡æ¡æ‰‹ã€‚', 'ä¸€èµ·æ¥ï¼Œç‰µç‰µæ‰‹ï¼Œ', 'åšæ¸¸æˆï¼Œé’©é’©æ‰‹ã€‚', 'è·³ä¸ªèˆï¼Œæ‹æ‹æ‰‹ã€‚', 'å†è§å•¦ï¼ŒæŒ¥æŒ¥æ‰‹ã€‚', 'æˆ‘ä»¬éƒ½æ˜¯å¥½æœ‹å‹ï¼Œ', 'äº²äº²çƒ­çƒ­æ‹‰æ‹‰æ‰‹ã€‚'] },
            { id: 's2', title: 'å°å°¾å·´', content: ['å¤§å…¬é¸¡ï¼ŒèŠ±å°¾å·´ï¼Œ', 'èµ°æ¥èµ°å»åƒæœµèŠ±. ', 'å°ç‹ç‹¸ï¼Œçº¢å°¾å·´ï¼Œ', 'è·‘æ¥èµ°å»åƒç«æŠŠã€‚', 'å°è‚¥çŒªï¼Œç»†å°¾å·´ï¼Œ', 'â€œå“¼å“¼â€ä¸€å£°æ‘‡ä¸¤ä¸‹ã€‚', 'å°å®å®ï¼Œè¿½å¦ˆå¦ˆï¼Œ', 'è¦å½“å¦ˆå¦ˆå°å°¾å·´ã€‚'] },
            { id: 's3', title: 'æ•²é—¨', content: ['æˆ‘ä¸€ä¸ªäººåœ¨å®¶çš„æ—¶å€™ï¼Œ', 'æ€»æƒ³çˆ¸çˆ¸å¦ˆå¦ˆæ¥æ•²é—¨ã€‚', 'æˆ‘å’Œçˆ¸çˆ¸åœ¨å®¶çš„æ—¶å€™ï¼Œ', 'æ€»æƒ³å¦ˆå¦ˆæ¥æ•²é—¨ã€‚', 'æˆ‘å’Œå¦ˆå¦ˆåœ¨å®¶çš„æ—¶å€™ï¼Œ', 'æ€»æƒ³çˆ¸çˆ¸æ¥æ•²é—¨ã€‚', 'æˆ‘ä»¬éƒ½åœ¨å®¶çš„æ—¶å€™ï¼Œ', 'æœ‹å‹æ€»ä¼šæ¥æ•²é—¨ã€‚'] },
            { id: 's4', title: 'é£çš„å®¶', content: ['å¤§é£æ²¡æœ‰å®¶ï¼Œ', 'å®ƒåœ¨æ‰¾å¦ˆå¦ˆã€‚', 'æˆ‘æŠŠé—¨å¼€å¼€ï¼Œ', 'ä½ ä¹Ÿæœ‰å®¶äº†ï¼Œ', 'è¿›æ¥å‘€!è¿›æ¥å‘€!', 'ä½ çš„å®¶ï¼Œåœ¨æˆ‘å®¶'] },
            { id: 's5', title: 'å”±æ­Œ', content: ['å°é¸¡å”±æ­Œï¼Œå½å½å½ã€‚', 'å°ç‹—å”±æ­Œï¼Œæ±ªæ±ªæ±ªã€‚', 'å°çŒ«å”±æ­Œï¼Œå–µå–µå–µã€‚', 'è€è™å”±æ­Œï¼Œå—·å—·å—·ã€‚', 'ä¸€ä¼šå„¿è½»ï¼Œä¸€ä¼šå„¿å“ã€‚', 'ä¸€ä¼šå„¿é«˜ï¼Œä¸€ä¼šå„¿ä½ã€‚', 'å¤§å®¶åœ¨ä¸€èµ·ï¼Œæ²¡å…³ç³»ã€‚'] },
            { id: 's6', title: 'æ·‹æµ´', content: ['å¤§ç™½è±¡ï¼Œç¬‘çœ¯çœ¯ï¼Œ', 'å®ƒè¯·å¤§å®¶æ´—æ·‹æµ´ã€‚', 'å°å…”å­ï¼Œå°èŠ±é¸¡ï¼Œ', 'å°é»„ç‹—ï¼Œå°çŒ«å’ªï¼Œ', 'æ´—å‘€æ´—ï¼Œæ´—å‘€æ´—ï¼Œ', 'é•¿é¼»å­å–·æ°´åƒä¸‹é›¨ã€‚'] },
            { id: 's7', title: 'æ‰“ç”µè¯', content: ['æœˆç‰™æœˆç‰™ä¸‹æ¥å§ï¼Œ', 'æˆ‘æƒ³è¯·ä½ æ‰“ç”µè¯ã€‚', 'å‘Šè¯‰å¤©å…¬å…¬:', 'æˆ‘ä»¬æ˜å¤©å»éƒŠæ¸¸ï¼Œ', 'è¯·åˆ«ä¸‹é›¨å‘€!'] },
            { id: 's8', title: 'å¦ˆå¦ˆ', content: ['ä½ ç»™æˆ‘æ´—è„¸ï¼Œ', 'ä½ ç»™æˆ‘æ¢³å¤´å‘ï¼Œ', 'ä½ ç»™æˆ‘æ¢è¡£æœï¼Œ', 'ä½ æ˜¯æˆ‘çš„å¦ˆå¦ˆã€‚', 'æˆ‘ç»™æ´‹å¨ƒå¨ƒæ´—è„¸ï¼Œ', 'æˆ‘ç»™æ´‹å¨ƒå¨ƒæ¢³å¤´å‘ï¼Œ', 'æˆ‘æ˜¯æ´‹å¨ƒå¨ƒçš„å¦ˆå¦ˆã€‚'] }
        ];

        // å„¿æ­Œæ­Œè¯æŒ‘æˆ˜é¢˜ç›®æ•°æ®
        const SONG_EXAM_QUESTIONS = [
            { id: 1, songId: 's1', playLyrics: ['ç¦»å¾—è¿œï¼Œæ‹›æ‹›æ‰‹ï¼Œ'], correct: 'èµ°è¿‘å•¦ï¼Œæ¡æ¡æ‰‹ã€‚', options: ['èµ°è¿‘å•¦ï¼Œæ¡æ¡æ‰‹ã€‚', 'è·³ä¸ªèˆï¼Œæ‹æ‹æ‰‹ã€‚', 'æˆ‘ä»¬éƒ½æ˜¯å¥½æœ‹å‹ï¼Œ'] },
            { id: 2, songId: 's1', playLyrics: ['ä¸€èµ·æ¥ï¼Œç‰µç‰µæ‰‹ï¼Œ'], correct: 'åšæ¸¸æˆï¼Œé’©é’©æ‰‹ã€‚', options: ['åšæ¸¸æˆï¼Œé’©é’©æ‰‹ã€‚', 'å†è§å•¦ï¼ŒæŒ¥æŒ¥æ‰‹ã€‚', 'äº²äº²çƒ­çƒ­æ‹‰æ‹‰æ‰‹ã€‚'] },
            { id: 3, songId: 's2', playLyrics: ['å¤§å…¬é¸¡ï¼ŒèŠ±å°¾å·´ï¼Œ'], correct: 'èµ°æ¥èµ°å»åƒæœµèŠ±.', options: ['èµ°æ¥èµ°å»åƒæœµèŠ±.', 'è·‘æ¥èµ°å»åƒç«æŠŠã€‚', 'è¦å½“å¦ˆå¦ˆå°å°¾å·´ã€‚'] },
            { id: 4, songId: 's2', playLyrics: ['å°ç‹ç‹¸ï¼Œçº¢å°¾å·´ï¼Œ'], correct: 'è·‘æ¥èµ°å»åƒç«æŠŠã€‚', options: ['è·‘æ¥èµ°å»åƒç«æŠŠã€‚', 'èµ°æ¥èµ°å»åƒæœµèŠ±.', 'â€œå“¼å“¼â€ä¸€å£°æ‘‡ä¸¤ä¸‹ã€‚'] },
            { id: 5, songId: 's3', playLyrics: ['æˆ‘ä¸€ä¸ªäººåœ¨å®¶çš„æ—¶å€™ï¼Œ'], correct: 'æ€»æƒ³çˆ¸çˆ¸å¦ˆå¦ˆæ¥æ•²é—¨ã€‚', options: ['æ€»æƒ³çˆ¸çˆ¸å¦ˆå¦ˆæ¥æ•²é—¨ã€‚', 'æ€»æƒ³å¦ˆå¦ˆæ¥æ•²é—¨ã€‚', 'æœ‹å‹æ€»ä¼šæ¥æ•²é—¨ã€‚'] },
            { id: 6, songId: 's3', playLyrics: ['æˆ‘ä»¬éƒ½åœ¨å®¶çš„æ—¶å€™ï¼Œ'], correct: 'æœ‹å‹æ€»ä¼šæ¥æ•²é—¨ã€‚', options: ['æœ‹å‹æ€»ä¼šæ¥æ•²é—¨ã€‚', 'æ€»æƒ³çˆ¸çˆ¸æ¥æ•²é—¨ã€‚', 'æ€»æƒ³å¦ˆå¦ˆæ¥æ•²é—¨ã€‚'] },
            { id: 7, songId: 's4', playLyrics: ['å¤§é£æ²¡æœ‰å®¶ï¼Œ'], correct: 'å®ƒåœ¨æ‰¾å¦ˆå¦ˆã€‚', options: ['å®ƒåœ¨æ‰¾å¦ˆå¦ˆã€‚', 'æˆ‘æŠŠé—¨å¼€å¼€ï¼Œ', 'ä½ çš„å®¶ï¼Œåœ¨æˆ‘å®¶'] },
            { id: 8, songId: 's5', playLyrics: ['å°é¸¡å”±æ­Œï¼Œå½å½å½ã€‚'], correct: 'å°ç‹—å”±æ­Œï¼Œæ±ªæ±ªæ±ªã€‚', options: ['å°ç‹—å”±æ­Œï¼Œæ±ªæ±ªæ±ªã€‚', 'è€è™å”±æ­Œï¼Œå—·å—·å—·ã€‚', 'å¤§å®¶åœ¨ä¸€èµ·ï¼Œæ²¡å…³ç³»ã€‚'] },
            { id: 9, songId: 's6', playLyrics: ['å¤§ç™½è±¡ï¼Œç¬‘çœ¯çœ¯ï¼Œ'], correct: 'å®ƒè¯·å¤§å®¶æ´—æ·‹æµ´ã€‚', options: ['å®ƒè¯·å¤§å®¶æ´—æ·‹æµ´ã€‚', 'å°å…”å­ï¼Œå°èŠ±é¸¡ï¼Œ', 'é•¿é¼»å­å–·æ°´åƒä¸‹é›¨ã€‚'] },
            { id: 10, songId: 's8', playLyrics: ['ä½ ç»™æˆ‘æ´—è„¸ï¼Œ'], correct: 'ä½ ç»™æˆ‘æ¢³å¤´å‘ï¼Œ', options: ['ä½ ç»™æˆ‘æ¢³å¤´å‘ï¼Œ', 'ä½ æ˜¯æˆ‘çš„å¦ˆå¦ˆã€‚', 'æˆ‘æ˜¯æ´‹å¨ƒå¨ƒçš„å¦ˆå¦ˆã€‚'] }
        ];

        const CARD_COLORS = ['border-red-400', 'border-blue-400', 'border-green-400', 'border-yellow-400', 'border-purple-400', 'border-pink-400', 'border-orange-400'];

        // --- å·¥å…·å‡½æ•° ---
        const speak = (text, rate = 0.9) => {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'zh-CN'; u.rate = rate; u.pitch = 1.2;
            window.speechSynthesis.speak(u);
        };

        // --- é€šç”¨ç»„ä»¶ ---
        const Confetti = () => (
            <div className="fixed inset-0 pointer-events-none z-[100] overflow-hidden">
                {[...Array(35)].map((_, i) => (
                    <div key={i} className="confetti-piece" style={{ 
                        left: `${Math.random() * 100}%`, 
                        backgroundColor: ['#ffeb3b', '#e91e63', '#00bcd4', '#4caf50', '#ff5722'][i%5],
                        animationDelay: `${Math.random() * 1.5}s`,
                        width: `${Math.random() * 10 + 8}px`,
                        height: `${Math.random() * 10 + 8}px`,
                        borderRadius: i%2 === 0 ? '50%' : '2px'
                    }} />
                ))}
            </div>
        );

        const Header = ({ title, onBack }) => (
            <div className="fixed top-0 inset-x-0 bg-white/90 backdrop-blur-md p-4 flex items-center shadow-sm z-[60] h-16 pt-[env(safe-area-inset-top)]">
                {onBack && (
                    <button onClick={onBack} className="w-10 h-10 flex items-center justify-center bg-blue-100 rounded-full text-blue-600 active:scale-90 transition-transform">
                        <span className="text-xl">â¬…ï¸</span>
                    </button>
                )}
                <h1 className="flex-1 text-center text-2xl font-black text-pink-500 truncate px-4">{title}</h1>
            </div>
        );

        const Navbar = ({ active, setMode }) => (
            <div className="fixed bottom-0 inset-x-0 bg-white/95 border-t border-pink-50 flex justify-around p-3 pb-[calc(env(safe-area-inset-bottom)+1rem)] z-[60]">
                {[
                    {id:'HOME', i:'ğŸ ', l:'é¦–é¡µ'},
                    {id:'CARDS', i:'ğŸƒ', l:'è¯†å­—'},
                    {id:'SONGS', i:'ğŸµ', l:'å„¿æ­Œ'},
                    {id:'STATS', i:'ğŸ“Š', l:'å®¶é•¿'}
                ].map(n => (
                    <button key={n.id} onClick={() => setMode(n.id)} className={`flex flex-col items-center gap-1 transition-all ${active.startsWith(n.id) ? 'text-pink-500 scale-110' : 'text-gray-400 opacity-60'}`}>
                        <span className="text-3xl">{n.i}</span>
                        <span className="text-[10px] font-bold">{n.l}</span>
                    </button>
                ))}
            </div>
        );

        // --- æ ¸å¿ƒå±å¹• ---
        const HomeScreen = ({ setMode, progress }) => {
            const dailyPercent = Math.min(100, (progress.daily / 10) * 100);
            return (
                <div className="h-screen overflow-y-auto pt-20 pb-32 px-6 space-y-6">
                    <Header title="å®è´è¶£å­¦å ‚" />
                    <div className="bg-white p-6 rounded-[2.5rem] shadow-xl border-4 border-pink-50">
                        <div className="flex justify-between items-end mb-4">
                            <div>
                                <h2 className="text-xl font-black text-gray-700">ä»Šæ—¥å°æˆå°± âœ¨</h2>
                                <p className="text-xs text-gray-400 font-bold">æ¯å¤©ååˆ†é’Ÿï¼Œå®å®æ›´èªæ˜</p>
                            </div>
                            <span className="text-2xl font-black text-pink-500">{progress.daily}/10</span>
                        </div>
                        <div className="w-full bg-gray-100 h-8 rounded-full overflow-hidden shadow-inner p-1">
                            <div className="h-full bg-gradient-to-r from-pink-400 via-red-400 to-yellow-400 rounded-full transition-all duration-1000" style={{ width: `${dailyPercent}%` }} />
                        </div>
                    </div>

                    <button onClick={() => setMode('EXAM_SELECT')} className="w-full bg-gradient-to-br from-orange-400 to-yellow-500 p-8 rounded-[3rem] shadow-2xl border-b-[12px] border-orange-700 flex items-center justify-between text-white active:translate-y-2 active:border-b-4 transition-all bouncy">
                        <div className="text-left">
                            <h2 className="text-4xl font-black mb-1">å¼€å§‹æŒ‘æˆ˜ ğŸ†</h2>
                            <p className="opacity-90 font-bold tracking-widest text-sm uppercase">èµ¢å–å‹‹ç« å§ï¼</p>
                        </div>
                        <span className="text-7xl">ğŸ¥‡</span>
                    </button>

                    <div className="grid grid-cols-2 gap-5">
                        <button onClick={() => setMode('CARDS')} className="aspect-square bg-blue-400 rounded-[2.5rem] flex flex-col items-center justify-center text-white shadow-xl border-b-[10px] border-blue-600 active:translate-y-2 active:border-b-4">
                            <span className="text-7xl mb-2">ğŸˆ</span>
                            <span className="text-2xl font-black">å¿«ä¹è¯†å­—</span>
                        </button>
                        <button onClick={() => setMode('SONGS')} className="aspect-square bg-pink-400 rounded-[2.5rem] flex flex-col items-center justify-center text-white shadow-xl border-b-[10px] border-pink-600 active:translate-y-2 active:border-b-4">
                            <span className="text-7xl mb-2">ğŸµ</span>
                            <span className="text-2xl font-black">å„¿æ­Œå¤§ç‹</span>
                        </button>
                    </div>
                </div>
            );
        };

        const CardScreen = ({ onBack, onMaster, progress }) => {
            const [idx, setIdx] = useState(0);
            const word = WORDS[idx];
            const isMastered = progress.mastered.includes(idx);
            useEffect(() => { speak(word); }, [idx]);

            return (
                <div className="h-screen bg-white pt-20 px-4 flex flex-col items-center">
                    <Header title="å¿«æ¥è®¤è®¤å®ƒ" onBack={onBack} />
                    <div className="w-full max-w-sm flex-1 max-h-[55vh]">
                        <div className={`h-full w-full glass-card rounded-[4rem] flex flex-col items-center justify-center p-8 border-[12px] transition-all duration-500 ${CARD_COLORS[idx % CARD_COLORS.length]}`}>
                            <div className="text-[11rem] drop-shadow-2xl mb-4 pop-up">{EMOJIS[word] || "âœ¨"}</div>
                            <h2 className="text-8xl font-black text-gray-800 tracking-tighter drop-shadow-sm">{word}</h2>
                            <button onClick={() => speak(word)} className="mt-8 bg-yellow-400 w-20 h-20 rounded-full text-4xl shadow-xl flex items-center justify-center active:scale-90 border-b-8 border-yellow-600">ğŸ”Š</button>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-6 w-full max-w-sm my-6">
                        <button onClick={() => setIdx(i => (i - 1 + WORDS.length) % WORDS.length)} className="jelly-btn py-5 bg-gradient-to-b from-blue-400 to-blue-500 rounded-[2rem] text-white shadow-xl border-b-8 border-blue-700 flex items-center justify-center gap-2">
                            <span className="text-3xl">â¬…ï¸</span>
                            <span className="text-xl font-black">ä¸Šä¸€ä¸ª</span>
                        </button>
                        <button onClick={() => setIdx(i => (i + 1) % WORDS.length)} className="jelly-btn py-5 bg-gradient-to-b from-blue-400 to-blue-500 rounded-[2rem] text-white shadow-xl border-b-8 border-blue-700 flex items-center justify-center gap-2">
                            <span className="text-xl font-black">ä¸‹ä¸€ä¸ª</span>
                            <span className="text-3xl">â¡ï¸</span>
                        </button>
                    </div>

                    <div className="grid grid-cols-2 gap-4 w-full max-w-sm mb-32">
                        <button onClick={() => setIdx(i=>(i+1)%WORDS.length)} className="py-6 bg-gray-100 text-gray-400 rounded-[2rem] font-black text-xl border-b-4 border-gray-200 active:translate-y-1">åœ¨å­¦ä¸­ ğŸ§</button>
                        <button onClick={() => { speak("å­¦ä¼šå•¦ï¼"); onMaster(idx); setIdx(i => (i + 1) % WORDS.length); }} className={`py-6 rounded-[2rem] text-xl font-black text-white shadow-lg border-b-8 ${isMastered ? 'bg-green-500 border-green-700' : 'bg-green-400 border-green-600 active:translate-y-1'}`}>
                            {isMastered ? 'å­¦ä¼šå•¦ âœ…' : 'å­¦ä¼šå•¦ ğŸ†'}
                        </button>
                    </div>
                </div>
            );
        };

        const SongScreen = ({ onBack, onRead, progress }) => {
            const [sel, setSel] = useState(null);
            if (sel) return (
                <div className="h-screen bg-pink-50 pt-20 px-4 overflow-y-auto pb-32">
                    <Header title={sel.title} onBack={() => setSel(null)} />
                    <div className="bg-white p-8 rounded-[3.5rem] shadow-2xl border-t-[15px] border-pink-400 pop-up">
                        <div className="space-y-6">
                            {sel.content.map((l, i) => <p key={i} onClick={() => speak(l)} className="text-3xl text-center font-black text-gray-700 active:text-pink-500 py-2 transition-all">{l}</p>)}
                        </div>
                        <div className="mt-12 space-y-4">
                            <button onClick={() => speak(sel.content.join(' '), 0.8)} className="w-full py-7 bg-pink-500 text-white rounded-[2.5rem] text-3xl font-black shadow-xl border-b-[10px] border-pink-700 active:translate-y-2">ğŸ”Š è¯»å…¨æ–‡</button>
                            <button onClick={() => { onRead(sel.id); setSel(null); speak("çœŸäº†ä¸èµ·ï¼è¯»å®Œå•¦ï¼"); }} className="w-full py-5 bg-green-400 text-white rounded-[2.5rem] text-xl font-black shadow-lg">æˆ‘è¯»å®Œå•¦ âœŒï¸</button>
                        </div>
                    </div>
                </div>
            );
            return (
                <div className="h-screen overflow-y-auto pt-20 px-6 pb-32 space-y-4">
                    <Header title="å„¿æ­Œå¤§ç‹" onBack={onBack} />
                    {SONGS.map((s, i) => (
                        <div key={s.id} onClick={() => setSel(s)} className="bg-white p-6 rounded-[2rem] flex items-center justify-between shadow-md border-l-[12px] border-pink-400 active:scale-95 transition-all">
                            <div className="flex items-center gap-5">
                                <span className="text-5xl">{['ğŸ°','ğŸ¦Š','ğŸ¥','ğŸ¶','ğŸ±','ğŸ»','ğŸ¦','ğŸ¦’'][i%8]}</span>
                                <span className="text-2xl font-black text-gray-800">{s.title}</span>
                            </div>
                            {progress.readSongs.includes(s.id) ? <span className="text-green-500 text-2xl font-black">âœ…</span> : <span className="text-pink-300 font-black">â”</span>}
                        </div>
                    ))}
                </div>
            );
        };

        const StatsScreen = ({ progress }) => {
            const masterPercent = Math.round((progress.mastered.length / WORDS.length) * 100);
            const hardest = Object.entries(progress.wrong || {}).sort((a,b)=>b[1]-a[1]).slice(0,3);
            return (
                <div className="h-screen overflow-y-auto pt-20 px-6 pb-32 space-y-6">
                    <Header title="æˆé•¿è®°å½•" />
                    <div className="bg-white p-8 rounded-[3rem] shadow-xl text-center border-b-[12px] border-purple-100">
                        <p className="text-gray-400 font-bold text-xs mb-3">è¯†å­—æ€»è¿›åº¦</p>
                        <div className="w-full bg-gray-100 h-10 rounded-full overflow-hidden shadow-inner p-1.5 mb-8">
                            <div className="h-full bg-gradient-to-r from-purple-400 to-red-400 rounded-full transition-all duration-1000" style={{ width: `${masterPercent}%` }} />
                        </div>
                        <div className="flex justify-around items-end">
                            <div><p className="text-6xl font-black text-purple-600">{progress.mastered.length}</p><p className="text-[10px] text-gray-400 mt-2">è®¤è¯†çš„å­—</p></div>
                            <div><p className="text-6xl font-black text-pink-500">{progress.readSongs.length}</p><p className="text-[10px] text-gray-400 mt-2">å­¦ä¼šå„¿æ­Œ</p></div>
                        </div>
                    </div>
                    {hardest.length > 0 && (
                        <div className="bg-[#FFF4E0] p-6 rounded-[3rem] border-4 border-orange-100">
                            <h3 className="font-black text-orange-800 mb-4 flex items-center gap-2"><span>ğŸ§ </span> é‡ç‚¹å¤ä¹ </h3>
                            <div className="flex flex-wrap gap-3">
                                {hardest.map(([idx, count]) => (
                                    <div key={idx} className="bg-white px-5 py-3 rounded-2xl shadow-sm border-2 border-orange-50 flex items-center gap-2">
                                        <span className="text-3xl font-black">{WORDS[idx]}</span>
                                        <span className="text-red-500 text-[10px] font-bold">è®¤é”™ {count} æ¬¡</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ExamScreen = ({ onBack, onMaster, onWrong }) => {
            const [step, setStep] = useState(0);
            const [score, setScore] = useState(0);
            const [finished, setFinished] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const questions = useMemo(() => {
                return [...Array(10)].map(() => {
                    const targetIdx = Math.floor(Math.random() * WORDS.length);
                    const opts = [WORDS[targetIdx], ...WORDS.filter((_, i) => i !== targetIdx).sort(() => 0.5 - Math.random()).slice(0, 2)].sort(() => 0.5 - Math.random());
                    return { targetIdx, opts };
                });
            }, []);

            const current = questions[step];
            useEffect(() => { if (!finished) speak(`è¯·æ‰¾å‡ºï¼š${WORDS[current.targetIdx]}`); }, [step, finished]);

            const handleAnswer = (ans) => {
                if (feedback) return;
                const correct = ans === WORDS[current.targetIdx];
                if (correct) { speak("ç­”å¯¹å•¦ï¼"); setScore(s => s + 1); setFeedback('correct'); onMaster(current.targetIdx); }
                else { speak("å†æ‰¾æ‰¾çœ‹ï¼Ÿ"); setFeedback('wrong'); onWrong(current.targetIdx); }
                setTimeout(() => {
                    setFeedback(null);
                    if (step < 9) setStep(s => s + 1);
                    else setFinished(true);
                }, 1500);
            };

            if (finished) return (
                <div className="h-screen pt-20 px-8 flex flex-col items-center justify-center space-y-8 bg-pink-50">
                    <Header title="æŒ‘æˆ˜ç»“æœ" />
                    <div className="bg-white w-full p-12 rounded-[4rem] shadow-2xl text-center pop-up">
                        <div className="text-[8rem] mb-6">ğŸ¥‡</div>
                        <h2 className="text-4xl font-black text-gray-800">æŒ‘æˆ˜å®Œæˆï¼</h2>
                        <div className="text-8xl font-black text-pink-500 my-8">{score}/10</div>
                        <button onClick={onBack} className="w-full py-6 bg-green-500 text-white rounded-[2.5rem] text-3xl font-black shadow-xl border-b-8 border-green-700">è¿”å›ä¸»é¡µ</button>
                    </div>
                </div>
            );

            return (
                <div className="h-screen bg-white pt-20 px-6 flex flex-col items-center">
                    <Header title={`æŒ‘æˆ˜ä¸­ ${step + 1}/10`} onBack={onBack} />
                    <div className={`w-full max-w-sm aspect-square glass-card rounded-[4rem] flex items-center justify-center p-8 border-[15px] transition-all duration-300 ${feedback === 'correct' ? 'border-green-400 scale-105' : feedback === 'wrong' ? 'border-red-400 shake' : 'border-blue-100'}`}>
                        <div className="text-[12rem] bouncy">{EMOJIS[WORDS[current.targetIdx]]}</div>
                    </div>
                    <div className="grid grid-cols-1 gap-5 w-full max-w-sm mt-12 mb-32">
                        {current.opts.map(opt => (
                            <button key={opt} onClick={() => handleAnswer(opt)} className="py-7 bg-white rounded-[2.5rem] text-5xl font-black text-gray-700 shadow-xl border-b-[10px] border-gray-100 active:translate-y-2">
                                {opt}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const SongExamScreen = ({ onBack, onSongMaster }) => {
            const [step, setStep] = useState(0);
            const [score, setScore] = useState(0);
            const [finished, setFinished] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const [playing, setPlaying] = useState(false);

            const questions = useMemo(() => {
                // éšæœºé€‰æ‹©10é“é¢˜ç›®
                const shuffled = [...SONG_EXAM_QUESTIONS].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, 10);
            }, []);

            const current = questions[step];

            const playLyrics = () => {
                if (playing) return;
                setPlaying(true);
                speak(current.playLyrics.join(''), 0.8);
                setTimeout(() => setPlaying(false), 2000);
            };

            const handleAnswer = (ans) => {
                if (feedback) return;
                const correct = ans === current.correct;
                if (correct) {
                    speak("ç­”å¯¹å•¦ï¼çœŸæ£’ï¼");
                    setScore(s => s + 1);
                    setFeedback('correct');
                    onSongMaster(current.songId);
                } else {
                    speak("å†å¬å¬çœ‹ï¼Ÿ");
                    setFeedback('wrong');
                }
                setTimeout(() => {
                    setFeedback(null);
                    if (step < 9) setStep(s => s + 1);
                    else setFinished(true);
                }, 1500);
            };

            if (finished) return (
                <div className="h-screen pt-20 px-8 flex flex-col items-center justify-center space-y-8 bg-pink-50">
                    <Header title="å„¿æ­ŒæŒ‘æˆ˜ç»“æœ" />
                    <div className="bg-white w-full p-12 rounded-[4rem] shadow-2xl text-center pop-up">
                        <div className="text-[8rem] mb-6">ğŸµ</div>
                        <h2 className="text-4xl font-black text-gray-800">å„¿æ­ŒæŒ‘æˆ˜å®Œæˆï¼</h2>
                        <div className="text-8xl font-black text-pink-500 my-8">{score}/10</div>
                        <button onClick={onBack} className="w-full py-6 bg-green-500 text-white rounded-[2.5rem] text-3xl font-black shadow-xl border-b-8 border-green-700">è¿”å›ä¸»é¡µ</button>
                    </div>
                </div>
            );

            return (
                <div className="h-screen bg-pink-50 pt-20 px-6 flex flex-col items-center">
                    <Header title={`å„¿æ­ŒæŒ‘æˆ˜ ${step + 1}/10`} onBack={onBack} />

                    <div className="w-full max-w-md glass-card rounded-[4rem] p-8 border-[15px] border-pink-200 mb-8">
                        <div className="text-center">
                            <div className="text-4xl font-black text-pink-600 mb-6">å¬å¬è¿™æ®µå„¿æ­Œï¼š</div>
                            <button
                                onClick={playLyrics}
                                disabled={playing}
                                className={`w-24 h-24 rounded-full text-4xl shadow-xl border-b-8 flex items-center justify-center transition-all ${playing ? 'bg-gray-300 border-gray-400 text-gray-500' : 'bg-pink-400 border-pink-600 text-white active:scale-90'}`}
                            >
                                {playing ? 'ğŸ”Š' : 'ğŸ”Š'}
                            </button>
                            <div className="mt-4 text-2xl font-black text-gray-700">
                                {current.playLyrics.join('')}
                            </div>
                        </div>
                    </div>

                    <div className={`w-full max-w-md glass-card rounded-[3rem] p-6 border-[12px] transition-all duration-300 mb-8 ${feedback === 'correct' ? 'border-green-400 scale-105' : feedback === 'wrong' ? 'border-red-400 shake' : 'border-purple-200'}`}>
                        <div className="text-center text-3xl font-black text-purple-600 mb-4">
                            ä¸‹ä¸€å¥æ˜¯ä»€ä¹ˆï¼Ÿ
                        </div>
                    </div>

                    <div className="grid grid-cols-1 gap-4 w-full max-w-md mb-32">
                        {current.options.map((opt, idx) => (
                            <button
                                key={idx}
                                onClick={() => handleAnswer(opt)}
                                className="py-6 bg-white rounded-[2rem] text-3xl font-black text-gray-700 shadow-xl border-b-[8px] border-gray-100 active:translate-y-2 disabled:opacity-50"
                                disabled={feedback !== null}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const Main = () => {
            const [mode, setMode] = useState('HOME');
            const [confetti, setConfetti] = useState(false);
            const [progress, setProgress] = useState(() => {
                const s = localStorage.getItem('baby_study_master_v1');
                return s ? JSON.parse(s) : { mastered: [], daily: 0, last: '', wrong: {}, readSongs: [] };
            });

            useEffect(() => {
                const today = new Date().toLocaleDateString();
                if (progress.last !== today) setProgress(p => ({ ...p, daily: 0, last: today }));
            }, []);

            useEffect(() => localStorage.setItem('baby_study_master_v1', JSON.stringify(progress)), [progress]);

            const triggerWin = () => { setConfetti(true); setTimeout(() => setConfetti(false), 2500); };

            const handleMaster = (idx) => {
                setProgress(p => {
                    const isNew = !p.mastered.includes(idx);
                    if (isNew) triggerWin();
                    return { ...p, mastered: isNew ? [...p.mastered, idx] : p.mastered, daily: isNew ? p.daily + 1 : p.daily };
                });
            };

            const handleWrong = (idx) => {
                setProgress(p => {
                    const newW = { ...p.wrong };
                    newW[idx] = (newW[idx] || 0) + 1;
                    return { ...p, wrong: newW };
                });
            };

            const handleReadSong = (id) => {
                setProgress(p => {
                    const isNew = !p.readSongs.includes(id);
                    if (isNew) triggerWin();
                    return { ...p, readSongs: isNew ? [...p.readSongs, id] : p.readSongs, daily: isNew ? p.daily + 1 : p.daily };
                });
            };

            const handleSongExamMaster = (songId) => {
                setProgress(p => {
                    const isNew = !p.readSongs.includes(songId);
                    if (isNew) triggerWin();
                    return { ...p, readSongs: isNew ? [...p.readSongs, songId] : p.readSongs, daily: isNew ? p.daily + 1 : p.daily };
                });
            };

            return (
                <div className="min-h-screen">
                    {confetti && <Confetti />}
                    {mode === 'HOME' && <HomeScreen setMode={setMode} progress={progress} />}
                    {mode === 'CARDS' && <CardScreen onBack={() => setMode('HOME')} onMaster={handleMaster} progress={progress} />}
                    {mode === 'SONGS' && <SongScreen onBack={() => setMode('HOME')} onRead={handleReadSong} progress={progress} />}
                    {mode === 'STATS' && <StatsScreen progress={progress} />}
                    {mode === 'EXAM_SELECT' && (
                        <div className="h-screen pt-20 px-6 space-y-6">
                            <Header title="äº²å­å¤§æŒ‘æˆ˜" onBack={() => setMode('HOME')} />
                            <div className="grid grid-cols-1 gap-6 mt-6">
                                <button onClick={() => setMode('EXAM_WORDS')} className="bg-white p-12 rounded-[4rem] shadow-2xl border-b-[15px] border-orange-200 flex flex-col items-center active:scale-95 transition-all">
                                    <span className="text-[8rem] mb-4">ğŸˆ</span>
                                    <h3 className="text-4xl font-black text-orange-600">è¯†å­—å°æ ‡å…µ</h3>
                                </button>
                                <button onClick={() => setMode('EXAM_SONGS')} className="bg-white p-12 rounded-[4rem] shadow-2xl border-b-[15px] border-pink-200 flex flex-col items-center active:scale-95 transition-all">
                                    <span className="text-[8rem] mb-4">ğŸµ</span>
                                    <h3 className="text-4xl font-black text-pink-600">å„¿æ­Œå°èƒ½æ‰‹</h3>
                                </button>
                                <div className="bg-pink-100 p-8 rounded-[3rem] text-center border-2 border-pink-200">
                                    <p className="text-pink-600 font-black">ğŸ’¡ äº²å­æ—¶åˆ»ï¼šè¯·å¿µå‡ºé¢˜ç›®è®©å®å®é€‰</p>
                                </div>
                            </div>
                        </div>
                    )}
                    {mode === 'EXAM_WORDS' && <ExamScreen onBack={() => setMode('EXAM_SELECT')} onMaster={handleMaster} onWrong={handleWrong} />}
                    {mode === 'EXAM_SONGS' && <SongExamScreen onBack={() => setMode('EXAM_SELECT')} onSongMaster={handleSongExamMaster} />}
                    <Navbar active={mode} setMode={setMode} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Main />);
    </script>
    <script>
        // å¼ºåˆ¶æ¸…é™¤æ—§ç¼“å­˜å’ŒService Workerï¼ˆä»…åœ¨éœ€è¦æ—¶ï¼‰
        if ('serviceWorker' in navigator) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…é™¤æ—§ç¼“å­˜ï¼ˆé€šè¿‡URLå‚æ•°æ§åˆ¶ï¼‰
            const urlParams = new URLSearchParams(window.location.search);
            const clearCache = urlParams.get('clearCache') === 'true' || localStorage.getItem('sw_clear_needed') === 'true';
            
            if (clearCache) {
                // å…ˆæ³¨é”€æ‰€æœ‰æ—§çš„Service Worker
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                    // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
                    if ('caches' in window) {
                        caches.keys().then(function(names) {
                            for (let name of names) {
                                caches.delete(name);
                            }
                            localStorage.removeItem('sw_clear_needed');
                            // æ¸…é™¤ç¼“å­˜åé‡æ–°æ³¨å†Œæ–°çš„Service Worker
                            setTimeout(() => {
                                navigator.serviceWorker.register('./sw.js?v=10').catch(() => {});
                                location.reload();
                            }, 100);
                        });
                    }
                });
            } else {
                // æ­£å¸¸æ³¨å†ŒService Worker
                navigator.serviceWorker.register('./sw.js?v=10').catch(() => {});
            }
        }
    </script>
</body>
</html>
